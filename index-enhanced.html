<!DOCTYPE html>
<html lang="en" dir="ltr" id="html-root">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Porsche Insurance (Enhanced Components)</title>
    <!-- Client Hints for better image loading -->
    <meta http-equiv="Accept-CH" content="DPR, Width, Viewport-Width" />
    <meta name="color-scheme" content="light" />
    <!-- Initial scale for improved performance -->
    <meta name="theme-color" content="#000000" />

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin />
    <link rel="preconnect" href="https://cdn.ui.porsche.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Preload critical fonts, CSS and images -->
    <link rel="preload" href="https://cdn.ui.porsche.com/porsche-design-system/fonts/porsche-next-latin-regular.b8f1c20.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="styles.css" as="style" />
    <link rel="preload" href="img/logo.png" as="image" />
    <link rel="preload" href="img/poster.jpg" as="image" />
    <link rel="preload" href="components-enhanced.js" as="script" />

    <!-- Prevent FOUC (Flash of Unstyled Content) -->
    <style>
      /* CSS Variables */
      :root {
        --phn-header-height: clamp(4rem, 6vw, 7rem);
        --nav-transition-duration: 0.3s;
        --section-padding: clamp(2rem, 5vw, 5rem);
        --card-padding: clamp(1rem, 3vw, 2rem);
        --text-spacing: clamp(0.75rem, 2vw, 1.5rem);
        --container-padding: clamp(1rem, 4vw, 2rem);
        --element-spacing: clamp(0.5rem, 2vw, 1rem);
      }

      /* Hide body until CSS is loaded */
      body {
        visibility: hidden;
      }
      
      /* Critical CSS for above-the-fold content */
      #hero {
        position: relative;
        width: 100%;
        height: 100vh;
      }
      
      nav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 50;
      }
    </style>

    <!-- Load Tailwind CSS with blocking - prevents FOUC -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="tailwind-config.js"></script>

    <!-- Load main CSS - with optimization -->
    <link rel="stylesheet" href="styles.css" media="print" onload="this.media='all'" />

    <!-- Fix FOUC when critical elements are loaded -->
    <script>
      // Track critical images for loading
      const criticalImages = ['img/logo.png', 'img/poster.jpg'];
      let loadedImages = 0;
      
      // Check if all critical images are loaded
      function checkCriticalImages() {
        loadedImages++;
        if (loadedImages >= criticalImages.length) {
          document.body.style.visibility = "visible";
        }
      }
      
      // Preload critical images
      criticalImages.forEach(src => {
        const img = new Image();
        img.onload = checkCriticalImages;
        img.onerror = checkCriticalImages; // Continue even if image fails
        img.src = src;
      });
      
      // Fallback if images don't load within 500ms
      setTimeout(function() {
        document.body.style.visibility = "visible";
      }, 500);
      
      // Make content visible once everything is loaded
      window.addEventListener("load", function () {
        document.body.style.visibility = "visible";
      });
    </script>
    
    <!-- Add Enhanced Component Loader -->
    <script src="components-enhanced.js" defer></script>
  </head>
  <body class="bg-white text-porsche">
    <!-- Navbar Component -->
    <div id="navbar-container" data-component="components/navigation/Navbar.html" data-param-logo="img/logo.png"></div>

    <!-- Hero Component -->
    <div id="hero-container" data-component="components/hero/Hero.html" 
         data-param-title="Premium protection for your Porsche"
         data-param-description="Specialized car insurance tailored for the precision, performance, and value of your Porsche."
         data-param-videoSrc="img/video.mp4"
         data-param-posterSrc="img/poster.jpg"></div>

    <!-- Insurance Coverage Section -->
    <section id="products" class="py-16 sm:py-20 md:py-24 lg:py-28 xl:py-36 bg-white section-spacing animate-section">
      <div class="container mx-auto px-4 sm:px-6">
        <!-- Section Header -->
        <div id="products-header" data-component="components/layout/SectionHeader.html" 
             data-param-title="Insurance Coverage"
             data-param-description="Comprehensive car insurance features designed specifically for Porsche vehicles."
             data-param-translateKey="insurance-coverage"></div>

        <!-- Benefit Cards Grid -->
        <div class="grid gap-8 xs:gap-10 sm:gap-12 lg:gap-16 grid-cols-1 sm:grid-cols-2 max-w-5xl mx-auto mobile-spacing">
          <!-- Card 1 -->
          <div id="benefit-card-1" data-component="components/cards/BenefitCard.html" 
               data-param-title="Performance Coverage"
               data-param-imageSrc="img/1.png"
               data-param-imageAlt="Performance Coverage"
               data-param-translateKey="performance-coverage"
               data-param-listItems='[
                 {"key": "track-day-insurance", "text": "Recreational track day insurance"},
                 {"key": "performance-parts", "text": "Performance parts coverage"},
                 {"key": "aftermarket-insurance", "text": "Aftermarket modifications insurance"},
                 {"key": "safe-driver", "text": "Safe driver discounts"}
               ]'></div>

          <!-- Card 2 -->
          <div id="benefit-card-2" data-component="components/cards/BenefitCard.html" 
               data-param-title="Concierge Insurance Services"
               data-param-imageSrc="img/2.png"
               data-param-imageAlt="Exclusive Services"
               data-param-translateKey="concierge-services"
               data-param-listItems='[
                 {"key": "claims-specialist", "text": "Dedicated claims specialist"},
                 {"key": "expedited-claims", "text": "Expedited claims processing"},
                 {"key": "owner-events", "text": "Porsche owner events access"},
                 {"key": "policy-concierge", "text": "Insurance policy concierge"}
               ]'></div>

          <!-- Card 3 -->
          <div id="benefit-card-3" data-component="components/cards/BenefitCard.html" 
               data-param-title="Premium Vehicle Protection"
               data-param-imageSrc="img/3.png"
               data-param-imageAlt="Premium Protection"
               data-param-translateKey="premium-protection"
               data-param-listItems='[
                 {"key": "agreed-value", "text": "Agreed value insurance"},
                 {"key": "oem-parts", "text": "OEM parts guarantee"},
                 {"key": "diminished-value", "text": "Diminished value coverage"},
                 {"key": "collectors-insurance", "text": "Collectors vehicle insurance"}
               ]'></div>

          <!-- Card 4 -->
          <div id="benefit-card-4" data-component="components/cards/BenefitCard.html" 
               data-param-title="Comprehensive Coverage"
               data-param-imageSrc="img/4.png"
               data-param-imageAlt="Global Coverage"
               data-param-translateKey="comprehensive-coverage"
               data-param-listItems='[
                 {"key": "international-coverage", "text": "International driving coverage"},
                 {"key": "roadside-assistance", "text": "Premium roadside assistance"},
                 {"key": "digital-claims", "text": "Digital claims filing"},
                 {"key": "luxury-transport", "text": "Luxury vehicle transport"}
               ]'></div>
        </div>
      </div>
    </section>

    <!-- Feature Banner - Using New Template Features -->
    <section class="relative bg-black text-white overflow-hidden animate-section">
      <div class="container mx-auto px-4 sm:px-6 py-16 sm:py-20 md:py-24 lg:py-28 xl:py-36 relative">
        <!-- Enhanced component using new features -->
        <div id="feature-banner" data-component="components/enhanced/FeatureBanner.html"
             data-param-title="Car insurance as exceptional as your Porsche"
             data-param-description="Our specialized auto insurance is designed with the same attention to detail and performance standards that define your Porsche, providing coverage that understands the unique value of your vehicle."
             data-param-imageSrc="img/5.png"
             data-param-imageAlt="Precision Engineering"
             data-param-features='[
               {"title": "Insurance That Matches Your Porsche", "description": "Protection that recognizes the precision engineering, performance capabilities, and distinctive value of your Porsche."},
               {"title": "Premium Coverage", "description": "Coverage options specifically designed for high-performance vehicles.", "isHighlighted": true},
               {"title": "Personalized Service", "description": "Dedicated team that understands your Porsche needs.", "isHighlighted": false}
             ]'
             data-param-showCta="true"
             data-param-ctaText="Get Your Porsche Covered"></div>
      </div>
    </section>

    <!-- Footer Component -->
    <div id="footer-container" data-component="components/footer/Footer.html" 
         data-param-logo="img/logo.png"
         data-param-year="2025"></div>

    <!-- Initialize Enhanced Components -->
    <script>
      // Register components once the DOM is loaded
      document.addEventListener("DOMContentLoaded", function() {
        // Register the Feature Banner component with state management
        ComponentSystem.registerComponent('feature-banner', {
          // Initial state
          state: {
            activeFeatureIndex: 0,
            autoRotate: true
          },
          
          // Event handlers
          events: {
            render: function() {
              // Setup feature rotation
              if (this.state.autoRotate) {
                this.startFeatureRotation();
              }
              
              // Set up click handlers for features
              const featureElements = this.$('.feature-item');
              featureElements.forEach((el, index) => {
                el.addEventListener('click', () => {
                  this.setState({ activeFeatureIndex: index });
                });
              });
              
              // Bind active state to feature elements
              featureElements.forEach((el, index) => {
                this.bind('activeFeatureIndex', el, {
                  attribute: 'class',
                  formatter: (activeIndex) => ({
                    'active': activeIndex === index,
                    'feature-item': true // Always keep base class
                  })
                });
              });
            }
          },
          
          // Component methods
          methods: {
            startFeatureRotation: function() {
              const features = this.getParam('features', []);
              if (!features.length) return;
              
              // Rotate features every 5 seconds
              setInterval(() => {
                if (!this.state.autoRotate) return;
                
                const nextIndex = (this.state.activeFeatureIndex + 1) % features.length;
                this.setState({ activeFeatureIndex: nextIndex });
              }, 5000);
            },
            
            stopRotation: function() {
              this.setState({ autoRotate: false });
            },
            
            startRotation: function() {
              this.setState({ autoRotate: true });
            }
          }
        });
        
        // Setup section animations with Intersection Observer
        const observerOptions = {
          rootMargin: "0px 0px -100px 0px",
          threshold: 0.1,
        };
        
        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("visible");
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);
        
        const animateSections = document.querySelectorAll(".animate-section");
        animateSections.forEach((section) => {
          observer.observe(section);
        });
      });
    </script>
  </body>
</html>